<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Route Tracker</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <header>
            <h1>Google Maps Route Tracker</h1>
            <p class="subtitle">Track routes, save to database, and get Slack notifications</p>
        </header>

        <div class="main-content">
            <div class="form-container">
                <div class="form-group">
                    <label for="origin">Origin Location:</label>
                    <input type="text" id="origin" name="origin" placeholder="e.g. Seattle, WA">
                </div>
                
                <div class="form-group">
                    <label for="destination">Destination Location:</label>
                    <input type="text" id="destination" name="destination" placeholder="e.g. Portland, OR">
                </div>
                
                <div class="button-container">
                    <button id="track-button" class="find-button">Find Route</button>
                </div>
            </div>

            <div class="api-status">
                <div id="api-status-indicator"></div>
            </div>

            <div id="results-container" class="hidden">
                <h2>Route Information</h2>
                <div class="results-content">
                    <div class="route-summary">
                        <div class="route-header">
                            <span id="result-origin"></span>
                            <span class="arrow">‚Üí</span>
                            <span id="result-destination"></span>
                        </div>
                    </div>
                    
                    <div class="stats-container">
                        <div class="stat-card">
                            <div class="stat-icon">üìè</div>
                            <div class="stat-value" id="result-distance"></div>
                            <div class="stat-label">Distance</div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon">‚è±Ô∏è</div>
                            <div class="stat-value" id="result-duration"></div>
                            <div class="stat-label">Duration</div>
                        </div>
                    </div>
                    
                    <div class="records-container" id="records-container"></div>
                    
                    <div class="status-indicators">
                        <div class="status-item">
                            <span class="status-icon" id="database-status">üíæ</span>
                            <span class="status-text">Saved to database</span>
                        </div>
                        <div class="status-item">
                            <span class="status-icon" id="slack-status">üí¨</span>
                            <span class="status-text">Sent to Slack</span>
                        </div>
                        <div class="status-item">
                            <span class="status-icon" id="log-status">üìÑ</span>
                            <span class="status-text">Logged to file</span>
                        </div>
                    </div>
                </div>
            </div>

            <div id="loading-container" class="hidden">
                <div class="loading-spinner"></div>
                <p>Tracking route...</p>
            </div>

            <div id="error-container" class="hidden">
                <div class="error-icon">‚ö†Ô∏è</div>
                <p id="error-message"></p>
            </div>
        </div>

        <footer>
            <p>Google Maps Route Tracking System &copy; 2025</p>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Check API status
            fetch('/api_status')
                .then(response => response.json())
                .then(data => {
                    const statusIndicator = document.getElementById('api-status-indicator');
                    if (data.api_configured) {
                        statusIndicator.innerHTML = '‚úÖ Google Maps API configured';
                        statusIndicator.classList.add('status-ok');
                    } else {
                        statusIndicator.innerHTML = '‚ùå Google Maps API not configured';
                        statusIndicator.classList.add('status-error');
                    }
                });

            // Handle form submission
            document.getElementById('track-button').addEventListener('click', function() {
                const origin = document.getElementById('origin').value.trim();
                const destination = document.getElementById('destination').value.trim();
                
                if (!origin || !destination) {
                    showError('Both origin and destination are required');
                    return;
                }
                
                // Show loading indicator
                document.getElementById('results-container').classList.add('hidden');
                document.getElementById('error-container').classList.add('hidden');
                document.getElementById('loading-container').classList.remove('hidden');
                
                // Create form data
                const formData = new FormData();
                formData.append('origin', origin);
                formData.append('destination', destination);
                
                // Send request
                fetch('/track_route', {
                    method: 'POST',
                    body: formData
                })
                .then(response => response.json())
                .then(data => {
                    // Hide loading indicator
                    document.getElementById('loading-container').classList.add('hidden');
                    
                    if (data.success) {
                        // Show results
                        document.getElementById('results-container').classList.remove('hidden');
                        
                        // Fill in route data
                        document.getElementById('result-origin').textContent = data.data.origin;
                        document.getElementById('result-destination').textContent = data.data.destination;
                        document.getElementById('result-distance').textContent = data.data.distance;
                        document.getElementById('result-duration').textContent = data.data.duration;
                        
                        // Show records if applicable
                        const recordsContainer = document.getElementById('records-container');
                        recordsContainer.innerHTML = '';
                        
                        if (data.data.is_min_distance || data.data.is_min_duration) {
                            recordsContainer.classList.remove('hidden');
                            
                            if (data.data.is_min_distance) {
                                const record = document.createElement('div');
                                record.className = 'record';
                                record.innerHTML = 'üèÜ This is the shortest distance recorded so far!';
                                recordsContainer.appendChild(record);
                            }
                            
                            if (data.data.is_min_duration) {
                                const record = document.createElement('div');
                                record.className = 'record';
                                record.innerHTML = '‚ö° This is the fastest route recorded so far!';
                                recordsContainer.appendChild(record);
                            }
                        } else {
                            recordsContainer.classList.add('hidden');
                        }
                        
                        // Update status indicators
                        document.getElementById('database-status').textContent = '‚úÖ';
                        document.getElementById('slack-status').textContent = '‚úÖ';
                        document.getElementById('log-status').textContent = '‚úÖ';
                    } else {
                        // Show error
                        showError(data.message);
                    }
                })
                .catch(error => {
                    document.getElementById('loading-container').classList.add('hidden');
                    showError('Error connecting to the server: ' + error);
                });
            });
            
            function showError(message) {
                const errorContainer = document.getElementById('error-container');
                const errorMessage = document.getElementById('error-message');
                
                errorMessage.textContent = message;
                errorContainer.classList.remove('hidden');
            }
        });
    </script>
</body>
</html>
